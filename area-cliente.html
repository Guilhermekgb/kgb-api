<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- === INÍCIO PATCH __API_BASE__ (auto) === -->
<script>
  (function(){
    var host = String(location.hostname||"").toLowerCase();

    // Produção (Netlify) -> API na Render
 var PROD_API = window.location.origin;
var DEV_API = (window.__API_BASE__ || window.location.origin);



    var base = (/\.netlify\.app$/.test(host)) ? PROD_API
             : (host === "localhost" || host === "127.0.0.1") ? DEV_API
             : PROD_API;

    try { localStorage.setItem("API_BASE", base); } catch(e) {}
    window.__API_BASE__ = base;
    console.log("[KGB] __API_BASE__ =", base);
  })();
</script>
<!-- === FIM PATCH __API_BASE__ (auto) === -->

  <title>Área do Cliente – Evento</title>

  <!-- Ícones -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <!-- Estilos -->
  <style>
    :root{ --brand:#5a3e2b; --brand-2:#c29a5d; --bg:#e2d1bd; --panel:#fff; --ink:#2d2730; --muted:#6c6271; --line:#ead9c8; --radius:16px; }
    html,body{margin:0;height:100%;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif}
    .frame{max-width:1140px;margin:0 auto;padding:28px}
    .hero{background:linear-gradient(92deg,#6c4f3b,#c6a36f);color:#fff;border-radius:20px;padding:16px;display:flex;align-items:center;justify-content:space-between;gap:18px;box-shadow:0 10px 28px rgba(0,0,0,.10)}
    .hero .left{display:flex;align-items:center;gap:16px}
    .avatar{width:96px;height:96px;border-radius:18px;overflow:hidden;display:grid;place-items:center;border:2px solid rgba(255,255,255,.35);background:#fff}
    .avatar img{width:100%;height:100%;object-fit:cover}
    .hero h1{margin:0;font-weight:800;font-size:22px;letter-spacing:.2px}
    .hero .meta{opacity:.9}
    .logo-ball{width:72px;height:72px;border-radius:50%;background:#fff;display:grid;place-items:center;border:2px solid rgba(255,255,255,.35);overflow:hidden}
    .logo-ball img{max-width:100%;max-height:100%;object-fit:contain}

    .kpis{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:14px;margin-top:16px}
    @media (max-width:880px){.kpis{grid-template-columns:1fr}}
    .kpi{background:var(--panel);border:1px solid var(--line);border-radius:14px;padding:14px;box-shadow:0 2px 12px rgba(0,0,0,.04)}
    .kpi .label{font-size:12px;color:var(--muted);margin-bottom:6px}
    .kpi .value{font-weight:800;font-size:20px}
    .bar{height:8px;background:#f1e7da;border-radius:8px;overflow:hidden;margin-top:10px}
    .bar i{display:block;height:100%;background:linear-gradient(90deg,var(--brand),var(--brand-2));width:0}

    .grid{display:grid;grid-template-columns:1.2fr .8fr;gap:16px;margin-top:16px}
    @media (max-width:980px){.grid{grid-template-columns:1fr}}
    .card{background:var(--panel);border:1px solid var(--line);border-radius:var(--radius);padding:18px;box-shadow:0 2px 14px rgba(0,0,0,.04)}
    .card h2{margin:0 0 10px;font-weight:800;font-size:18px;color:#3b2a21}
    .muted{color:var(--muted)}

    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .stack{display:grid;gap:10px}
    .btn{appearance:none;border:none;background:var(--brand);color:#fff;border-radius:10px;padding:10px 12px;font-weight:800;letter-spacing:.2px;box-shadow:0 8px 22px rgba(0,0,0,.08);cursor:pointer;text-decoration:none;display:inline-flex;align-items:center;gap:8px}
    .btn:hover{filter:brightness(.98)}
    .btn.ghost{background:#fff;color:var(--brand);border:1px solid var(--brand);box-shadow:none}
    .btn.icon{padding:8px 10px}
    .btn[disabled]{opacity:.55;cursor:not-allowed}

    .table{width:100%;border-collapse:collapse}
    .table th,.table td{padding:10px 6px;border-bottom:1px dashed var(--line);text-align:left}
    .table th{font-size:12px;color:var(--muted)}
    .num{text-align:right}

    .badge{display:inline-block;border:1px solid var(--line);border-radius:999px;padding:3px 8px;font-size:12px;color:var(--muted)}
    .ok{background:#e7f7ef;border-color:#c2ebd5;color:#137a54}
    .warn{background:#fff3cd;border-color:#ffe69c;color:#8a6d1b}
    .err{background:#ffe3df;border-color:#ffb3a9;color:#b3432c}

    .menu-compact{display:flex;align-items:center;gap:12px}
    .menu-compact .thumb{width:110px;height:74px;background:#fbf6ee;border:1px solid var(--line);border-radius:10px;overflow:hidden;display:grid;place-items:center}
    .menu-compact .thumb img{width:100%;height:100%;object-fit:cover}
    .menu-compact .thumb .iconwrap{display:grid;place-items:center;width:100%;height:100%;background:linear-gradient(135deg,#f9f1e6,#f0e3d1)}
    .menu-compact .thumb .iconwrap img{width:60%;opacity:.9;object-fit:contain}
    .menu-compact .thumb svg{width:48px;height:48px;opacity:.55}
    .menu-compact .info{min-width:0}
    .menu-compact .name{font-weight:700}
    .menu-compact .desc{font-size:12px;color:var(--muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:360px}
    .chiplist{display:flex;flex-wrap:wrap;gap:6px;margin-top:8px}
    .chip{border:1px solid var(--line);border-radius:999px;padding:4px 8px;font-size:12px;background:#fffaf4}

    textarea{width:100%;min-height:120px;border:1px solid var(--line);border-radius:12px;padding:12px;font-size:14px}

    /* Modal */
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.52);display:none;align-items:center;justify-content:center;z-index:50}
    .modal.open{display:flex}
    .modal .box{max-width:92vw;max-height:86vh;background:#fff;border-radius:14px;box-shadow:0 20px 60px rgba(0,0,0,.25);padding:10px;overflow:auto}
    .modal .box img{max-width:100%;display:block;margin:0 auto 12px;border-radius:10px}
    .modal .top{display:flex;justify-content:flex-end}
  .timeline {
  list-style: none;
  margin: 0;
  padding: 0;
  border-left: 2px solid rgba(0,0,0,0.08);
}

.timeline .tl-item {
  position: relative;
  padding: 12px 0 12px 16px;
}

.timeline .tl-item::before {
  content: '';
  position: absolute;
  left: -6px;
  top: 16px;
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: var(--brand-2, #c29a5d);
}

.timeline .tl-item.destaque::before {
  background: var(--brand, #5a3e2b);
}

.timeline .tl-data {
  font-size: 0.8rem;
  color: #888;
}

.timeline .tl-conteudo strong {
  display: block;
  margin-bottom: 4px;
}
</style>
</head>

<body>
  <div class="frame">
    <div class="hero">
      <div class="left">
        <div class="avatar"><img id="fotoCliente" alt="Cliente"></div>
        <div>
          <h1 id="nomeEvento">-</h1>
          <div class="meta">
            <span id="dataEvento">-</span> · <span id="localEvento">-</span> · <span id="qtdConvidados">-</span> convidados
          </div>
        </div>
      </div>
      <div class="logo-ball" id="logoBall" style="display:none"><img id="logoEmpresa" alt="Logo do Buffet"></div>
    </div>

    <section class="kpis">
      <div class="kpi">
        <div class="label">Valor do contrato</div>
        <div class="value" id="vContrato">R$ 0,00</div>
        <div class="bar"><i id="pg"></i></div>
      </div>
      <div class="kpi">
        <div class="label">Pago</div>
        <div class="value" id="vPago">R$ 0,00</div>
      </div>
      <div class="kpi">
        <div class="label">Pendente</div>
        <div class="value" id="vPendente">R$ 0,00</div>
      </div>
    </section>

    <div class="grid">
      <div class="col">
        <div class="card">
          <h2>Etapas do Evento</h2>
          <table class="table">
            <thead><tr><th>Etapa</th><th class="num">Status</th></tr></thead>
            <tbody id="tbodyEtapas"></tbody>
          </table>
        </div>

        <div class="card" style="margin-top:16px">
          <h2>Contratos e Adendos</h2>
          <table class="table">
            <thead><tr><th>Data</th><th>Conteúdo</th><th class="num">Assinaturas</th><th class="num">Anexo</th></tr></thead>
            <tbody id="tbodyContratos"><tr><td colspan="4" class="muted">Sem documentos.</td></tr></tbody>
          </table>
        </div>

        <div class="card" style="margin-top:16px">
          <h2>Cardápio contratado</h2>
          <div class="menu-compact">
            <div class="thumb" id="thumbCardapio">
              <img id="imgCardapio" alt="Cardápio" style="display:none">
              <div class="iconwrap" id="iconFallback" style="display:none"></div>
            </div>
            <div class="info">
              <div class="name" id="nomeCardapio">-</div>
              <div class="desc" id="descCardapio">-</div>
              <div class="row" style="margin-top:8px">
                <a id="btnBaixarCardapio" class="btn" download><i data-lucide="download"></i> Baixar</a>
                <button id="btnVerCardapio" class="btn ghost"><i data-lucide="eye"></i> Visualizar</button>
              </div>
              <div class="chiplist" id="listaItensContratados"></div>
            </div>
          </div>
        </div>

        <div class="card" style="margin-top:16px">
          <h2>Pagamentos</h2>
          <table class="table">
            <thead><tr><th>Data</th><th>Descrição</th><th class="num">Valor</th><th class="num">Status</th><th class="num">Anexo</th></tr></thead>
            <tbody id="tbodyPagamentos"><tr><td colspan="5" class="muted">Sem registros.</td></tr></tbody>
          </table>
        </div>

        <div class="row" style="margin-top:16px;gap:16px;flex-wrap:wrap">
          <div class="card" style="flex:1 1 380px">
            <h2>Definição de cardápio</h2>
            <div id="defCardapioInfo" class="stack"><span class="badge warn">Pendente</span></div>
          </div>
          <div class="card" style="flex:1 1 380px">
            <h2>Definição de layout</h2>
            <div id="defLayoutInfo" class="stack"><span class="badge warn">Pendente</span></div>
          </div>
        </div>
      </div>

      <aside class="col">
        <div class="card" id="cardContagem" style="margin-top:16px">
          <h2>Contagem regressiva</h2>
          <div class="row" style="align-items:baseline">
            <div id="countNum" style="font-weight:800;font-size:34px;line-height:1">--</div>
            <div id="countLabel" class="muted">dias</div>
          </div>
          <div id="countSub" class="muted" style="margin-top:6px">Faltam — dias para o grande dia!</div>
        </div>

        <div class="card" style="margin-top:16px">
          <h2>Anotações sobre cardápio</h2>
          <textarea id="notaCardapio" placeholder="Preferências, restrições, ajustes..."></textarea>
          <div class="row" style="margin-top:8px">
            <button id="salvarNotas" class="btn"><i data-lucide="save"></i> Salvar</button>
            <span id="hintNotas" class="muted"></span>
          </div>
        </div>

        <div class="card" style="margin-top:16px">
          <h2>Dúvidas, sugestões e ideias</h2>
          <textarea id="duvidasIdeias" placeholder="Escreva aqui suas dúvidas ou ideias..."></textarea>
          <div class="row" style="margin-top:8px">
            <button id="salvarIdeias" class="btn"><i data-lucide="save"></i> Salvar</button>
            <span id="hintIdeias" class="muted"></span>
          </div>
        </div>

        <div class="card" style="margin-top:16px">
          <h2>Fale com o buffet</h2>
          <p class="muted">Clique para abrir o WhatsApp.</p>
          <a id="btnWhats" class="btn" target="_blank"><i data-lucide="message-circle"></i> WhatsApp</a>
        </div>

        <div class="card" style="margin-top:16px" id="mensagemFinal">
          <h2>Mensagem do buffet</h2>
          <p id="saudacaoMensagem" class="muted">
            Obrigada pela confiança — é um prazer fazer parte desse sonho!
          </p>
        </div>
      </aside>
    </div>

    <p class="footer">© <span id="nomeEmpresa">Seu Buffet</span> · Área do Cliente</p>
  </div>

  <!-- Modal -->
  <div class="modal" id="modal">
    <div class="box">
      <div class="top"><button id="fecharModal" class="btn ghost icon" aria-label="Fechar"><i data-lucide="x"></i></button></div>
      <div id="boxMedia"></div>
    </div>
  </div>

<script src="area-cliente.js" defer></script>
</body>
</html>

